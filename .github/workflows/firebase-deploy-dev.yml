# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy app to develop environment

on:
    push:
        branches: ["develop"]

env:
    NODE_VERSION: "18.13"
    PROJECT_ID: satience-dev

jobs:
    setup:
        runs-on: ubuntu-latest
        name: "Build and deploy the firebase project"
        environment: dev
        steps:
            - uses: actions/checkout@v3
            - name: Setup Node ${{ env.NODE_VERSION }} Environment
              uses: actions/setup-node@v3
              with:
                  node-version: ${{ env.NODE_VERSION }}
            - name: Cache node modules
              id: cache-npm
              uses: actions/cache@v3
              env:
                  cache-name: cache-node-modules
              with:
                  # npm cache files are stored in `~/.npm` on Linux/macOS
                  path: ~/.npm
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}
                  restore-keys: |
                      ${{ runner.os }}-build-${{ env.cache-name }}-
                      ${{ runner.os }}-build-
                      ${{ runner.os }}-
            - name: "Download dependencies and build"
              shell: bash
              run: |
                  echo "install dependencies in base folder"
                  pwd
                  yarn install
                  echo "build dependencies in base folder"
                  yarn build
                  echo "go into functions folder"
                  cd functions
                  pwd
                  echo "install dependencies in functions folder"
                  yarn install
                  echo "build dependencies in functions folder"
                  yarn tsc
            - name: Deploy to Firebase
              uses: w9jds/firebase-action@master
              with:
                  args: deploy --non-interactive -f
              env:
                  FIREBASE_TOKEN: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_SATIENCE_DEV }}
                  REACT_APP_FIREBASE_AUTH_DOMAIN: ${{ secrets.REACT_APP_FIREBASE_AUTH_DOMAIN }}
